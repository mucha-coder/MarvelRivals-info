---
import type { CollectionEntry } from 'astro:content';
import { type Lang, useTranslations } from '../i18n/ui';

interface Props {
  post: CollectionEntry<'posts'>;
  lang: Lang;
}

const { post, lang } = Astro.props;
const t = useTranslations(lang);

// slugから言語プレフィックスを除去
const slug = post.slug.replace(/^(ja|en)\//, '');
const href = lang === 'ja' ? `/${slug}` : `/en/${slug}`;

// カテゴリの表示名を取得
const categoryKey = `category.${post.data.category}` as keyof ReturnType<typeof useTranslations>;
const categoryLabel = t(categoryKey);

// 日付フォーマット
const dateFormatter = new Intl.DateTimeFormat(lang === 'ja' ? 'ja-JP' : 'en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});
---

<article class="py-4 border-b border-gray-100 last:border-b-0">
  <div class="flex items-start justify-between gap-4">
    <div class="flex-1 min-w-0">
      <!-- Category & Date -->
      <div class="flex items-center gap-3 text-sm text-gray-500 mb-1">
        <span class="text-blue-600 font-medium">{categoryLabel}</span>
        <span>•</span>
        <time datetime={post.data.pubDate.toISOString()}>
          {dateFormatter.format(post.data.pubDate)}
        </time>
      </div>

      <!-- Title -->
      <h3 class="text-lg font-medium text-gray-900 hover:text-blue-600 transition-colors">
        <a href={href} class="hover:underline">
          {post.data.title}
        </a>
      </h3>

      <!-- Description -->
      <p class="mt-1 text-sm text-gray-600 line-clamp-2">
        {post.data.description}
      </p>

      <!-- Related Heroes -->
      {post.data.heroes && post.data.heroes.length > 0 && (
        <div class="mt-2 flex flex-wrap gap-1">
          {post.data.heroes.slice(0, 3).map((hero) => (
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-600">
              {hero}
            </span>
          ))}
          {post.data.heroes.length > 3 && (
            <span class="text-xs text-gray-400">+{post.data.heroes.length - 3}</span>
          )}
        </div>
      )}
    </div>
  </div>
</article>
