---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { useTranslations } from '../../i18n/ui';

export async function getStaticPaths() {
  const categories = ['patch-notes', 'hero-balance', 'events', 'guides'];
  
  return categories.map((category) => {
    return {
      params: { category },
      props: { category },
    };
  });
}

const { category } = Astro.props;
const lang = 'ja';
const t = useTranslations(lang);

// カテゴリ名を取得
const categoryKey = `category.${category}` as any;
const categoryName = t(categoryKey);

// 記事を取得してフィルタリング
const posts = await getCollection('posts', ({ id, data }) => {
  return id.startsWith('ja/') && data.category === category;
});
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const title = `${categoryName} | ${t('site.title')}`;
const description = `${categoryName}の記事一覧です。`;
---

<BaseLayout title={title} description={description} lang={lang}>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-white mb-2">{categoryName}</h1>
      <p class="text-gray-400">{description}</p>
    </header>

    <!-- Posts Grid -->
    {sortedPosts.length > 0 ? (
      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        {sortedPosts.map((post) => (
          <PostCard post={post} lang={lang} />
        ))}
      </div>
    ) : (
      <div class="text-center py-20 bg-white/5 rounded-xl border border-white/10">
        <p class="text-gray-400 text-lg">まだ記事がありません</p>
        <a href="/" class="inline-block mt-4 text-yellow-400 hover:text-yellow-300 transition-colors">
          ホームに戻る
        </a>
      </div>
    )}
  </div>
</BaseLayout>

{/* Helper to avoid type error with description inside p tag if needed, currently direct usage is fine */}
